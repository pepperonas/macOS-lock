name: Build and Release macOS App

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build:
    runs-on: macos-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          pip3 install --user pyobjc-core pyobjc-framework-Quartz

      - name: Create app bundle
        run: |
          chmod +x create_app.sh
          ./create_app.sh

      - name: Create archive
        run: |
          tar -czf macOS-Lock.app.tar.gz "macOS Lock.app"

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          files: macOS-Lock.app.tar.gz
          body: |
            ## macOS Lock ${{ github.ref_name }}

            ### Installation
            1. Download `macOS-Lock.app.tar.gz`
            2. Extract the archive: `tar -xzf macOS-Lock.app.tar.gz`
            3. Move `macOS Lock.app` to your Applications folder
            4. Right-click and select "Open" the first time to bypass Gatekeeper
            5. Grant Accessibility permissions when prompted

            ### Requirements
            - macOS 10.14 or later
            - Apple Silicon (M1/M2/M3) or Intel

            ### Features
            - Lock keyboard and mouse input
            - Unlock with X+C key combination
            - Lightweight and secure

            Built for Apple Silicon with universal binary support.
          draft: false
          prerelease: false
